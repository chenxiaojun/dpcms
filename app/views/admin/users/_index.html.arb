context.instance_eval do
  selectable_column
  column(:id)
  column(:user_name, sortable: false)
  column(:avatar, sortable: false) do |user|
    user.avatar.url ? image_tag(user.avatar, height: 100, width: 100) : ''
  end
  column(:nick_name, sortable: false)
  column(:mobile, sortable: false)
  column(:email, sortable: false)
  column(:signature, sortable: false)
  column(:user_extra_status, sortable: false) do |user|
    status = user.user_extra.try(:status)
    status.eql?('passed') ? '已实名' : '未实名'
  end
  column(:last_visit)
  column(:login_count)
  column(:mark)
  column(:total_number) do |user|
      user.orders.where.not(status: %w(unpaid canceled)).count
    end
  column(:total_fee) do |user|
    user.orders.where.not(status: %w(unpaid canceled)).sum('price')
  end
  actions(name: '操作', defaults: false) do |user|
    item '详情', admin_user_path(user), class: 'member_link'
    item '编辑', edit_admin_user_path(user), class: 'member_link'
    if user.role.eql?('banned')
      item '启用', user_banned_admin_user_path(user), data: { confirm: '确定取消禁用该用户吗？' }, method: :post
    else
      item '禁用', user_banned_admin_user_path(user), data: { confirm: '确定禁用该用户吗？' }, method: :post
    end
  end
  actions(name: '实名操作', defaults: false) do |user|
    item '实名管理', admin_user_user_extras_path(user)
  end
end
